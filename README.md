# 音频分割工具

这是一个基于Python和FFmpeg的音频分割工具，可以根据用户设定的要求自动分割音频文件。

## 功能特点

1. **图形界面**：提供简单易用的GUI界面
2. **批量处理**：支持批量处理文件夹中的所有音频文件
3. **智能分割**：按照用户指定的时长自动分割音频
4. **语音优化**：自动去除非人声部分和静音段
5. **高级平滑结束**：每个音频片段末尾添加高级过渡音效和淡出效果，避免生硬结束
6. **自动过滤**：自动丢弃时长不足的音频片段
7. **输出路径自定义**：可选择处理结果保存位置
8. **多种输出格式**：支持WAV、MP3、FLAC、AAC、OGG、M4A等多种音频格式
9. **过渡音效支持**：可自定义过渡音效文件
10. **快捷打开**：一键打开输出文件夹查看结果
11. **跨平台支持**：同时支持Windows和macOS系统
12. **参数持久化**：自动保存用户设置，下次启动时自动恢复

## 环境要求

- Python 3.6+
- FFmpeg

## 安装说明

### 1. 安装Python
确保系统已安装Python 3.6或更高版本。

### 2. 安装FFmpeg

**Windows:**
1. 访问 https://www.gyan.dev/ffmpeg/builds/
2. 下载完整版本的FFmpeg
3. 解压到目录并添加到系统PATH环境变量

**macOS:**
```bash
brew install ffmpeg
```

**Ubuntu/Debian:**
```bash
sudo apt update && sudo apt install ffmpeg
```

### 3. 克隆项目
```bash
git clone <repository-url>
cd cup-audio
```

## 使用方法

1. 运行程序：
   ```bash
   python audio_splitter.py
   ```

2. 在GUI界面中：
   - 点击"浏览"选择包含音频文件的文件夹
   - 设置分割时长（秒）
   - 选择输出格式（WAV、MP3、FLAC、AAC、OGG、M4A）
   - 可选：选择过渡音效文件（支持WAV、MP3等音频格式）
   - 选择是否启用高级音频处理
   - 可选：点击输出路径旁的"浏览"按钮选择自定义输出文件夹
   - 点击"开始处理"
   - 处理完成后，可通过"打开文件夹"按钮快速查看结果

3. 处理完成后，分割后的音频文件将保存在指定的输出文件夹中

4. 下次启动程序时，之前的设置将自动恢复

## 过渡音效文件

过渡音效文件应该是短时长的音频文件（建议0.1-0.3秒），用于在音频片段结尾添加平滑的过渡效果。您可以使用以下类型的音效：

- 轻柔的"咔嗒声"
- 混响尾音
- 渐弱的白噪音
- 其他短时长的环境音效

如果您需要音效文件，可以下载以下推荐的音效：
- [Freesound.org](https://freesound.org/) - 免费音效库
- [Zapsplat](https://www.zapsplat.com/) - 免费和付费音效
- [Adobe Audition音效库](https://www.adobe.com/products/audition/offers/audition-downloads.html)

确保音效文件格式为WAV、MP3、FLAC、AAC、OGG或M4A之一。

## 处理流程

### 1. 去除非人声部分
使用专业的音频处理技术去除非人声部分：
- **声道优化**：将立体声转为单声道并混合左右声道的人声信号，减少因声道差异导致的人声遗漏
- **信号增强**：通过高通滤波(200Hz)和低通滤波(3000Hz)突出人声频段特征，提升人声音量与清晰度
- **降噪提纯**：使用频域降噪技术去除残留的非人声杂音

### 2. 按时长分割
按照用户设定的时长分割音频

### 3. 高级过渡效果
为每个片段末尾添加高级结束处理：
- **音效混合**：可选的过渡音效与音频片段混合
- **结尾淡出**：渐进式淡出效果，让人声自然收尾

### 4. 过滤短片段
自动丢弃时长不足的片段

## 支持的输出格式

- **WAV**: 无损音频格式，质量最高
- **MP3**: 最流行的音频格式，兼容性好
- **FLAC**: 无损压缩音频格式，文件较小
- **AAC**: 高效音频编码，质量优于MP3
- **OGG**: 开源音频格式，压缩率高
- **M4A**: Apple开发的音频格式，常用于iTunes

## 高级处理功能

启用高级音频处理后，工具将应用以下增强功能：

1. **专业人声分离**：采用专业的音频处理技术去除非人声部分
2. **高级过渡效果**：使用过渡音效和淡出技术，使音频结束更加自然
3. **平滑过渡处理**：确保音频片段结束时不会有突兀感
4. **音频质量增强**：自动调整音频的动态范围和音量

## 参数持久化

工具会自动保存以下用户设置：
- 音频文件夹路径
- 分割时长
- 高级处理选项状态
- 输出文件夹路径
- 输出格式选择
- 过渡音效文件路径
- 窗口大小和位置

配置文件位置：
- **Windows**: `%APPDATA%\AudioSplitter\config.json`
- **macOS**: `~/Library/Application Support/AudioSplitter/config.json`
- **Linux**: `~/.config/audiosplitter/config.json`

## 问题修复记录

### v1.8 添加专业音频处理和过渡音效支持
- 实现了专业的去除非人声部分算法（声道优化、信号增强、降噪提纯）
- 添加了过渡音效支持，用户可自定义过渡音效文件
- 实现了音效混合和结尾淡出的双步骤处理逻辑
- 改进了音频片段结束处理的自然度

### v1.7 修复去除非人声和"自然结束"效果
- 修复了silenceremove滤镜参数错误
- 实现了有效的去除非人声部分功能，通过音量增强验证效果
- 修复了"自然结束"效果的滤镜链语法错误
- 改进了音频片段结束处理的自然度

### v1.6 优化去除非人声和"嘎然而止"效果
- 回退到更有效的去除非人声算法
- 实现了高级"嘎然而止"效果，包含快速淡出、低通滤波和轻微压缩
- 改进了音频片段结束处理的自然度

### v1.5 优化静音移除功能
- 实现了更高级的静音检测和移除算法
- 添加了语音活动检测和噪声抑制
- 改进了音频质量标准化处理

### v1.4 添加输出格式选项
- 实现了多种音频格式输出支持
- 添加了格式选择下拉菜单
- 更新了FFmpeg编码参数以支持不同格式

### v1.3 参数持久化功能
- 实现了所有GUI参数的自动保存和恢复
- 添加了跨平台的配置文件管理
- 增强了用户体验，无需每次重新设置参数

### v1.2 跨平台兼容性增强
- 为输出路径添加了浏览按钮，可自定义输出文件夹
- 增强了Windows和macOS系统的兼容性
- 清理了项目中不必要的测试文件

### v1.1 修复音频分割问题
- 修复了分割后的音频只有第一秒有声音的问题
- 优化了FFmpeg参数，确保完整音频片段被正确提取
- 改进了淡出效果的应用方式

### v1.0 初始版本
- 基本音频分割功能
- GUI界面操作
- 高级音频处理选项

## 注意事项

- 请确保FFmpeg已正确安装并添加到系统PATH
- 处理大文件时可能需要较长时间，请耐心等待
- 启用高级处理功能会增加处理时间，但会提供更好的音频质量
- 处理完成后可通过界面按钮快速打开输出文件夹
- 不同音频格式的文件大小和质量会有所不同
- 过渡音效文件应为短时长音频（建议0.1-0.3秒）